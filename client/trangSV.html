<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <title>Hệ thống lễ tốt nghiệp</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="./css/trangSV.css">
  <script src="./javascripts/trangSV.js" defer></script>
  <script src="./javascripts/thongtin.js" defer></script>
  <script src="./javascripts/login.js" defer></script>
</head>

<body>
  <!-- HEADER -->
  <div class="header">
    <img src="./images/logo-hutech-1.png" onclick="loadSection('trangchuSV.html', 'info', event)" alt="logo"
      style="display: flex; width: auto; height: 40px; object-fit: contain; cursor: pointer;" />
    <div style="display: flex; align-items: center; margin: auto; gap: 15px">
      <strong>Hệ thống lễ tốt nghiệp</strong>
    </div>
    <div class="right-section">
      <i class="fa-sharp fa-solid fa-circle-user" style="color: #000000; font-size: 20px;"></i>
      <span id="mssv">---</span>

      <!-- Dropdown menu -->
      <div class="user-dropdown">
        <a href="#" onclick="loadSection('thongtincanhan.html', 'info', event)">
          <i class="fas fa-id-card"></i> Thông tin sinh viên
        </a>
        <a href="#" onclick="loadSection('doimatkhau.html', 'info', event)">
          <i class="fa-solid fa-key" style="color: #000000;"></i> Đổi mật khẩu
        </a>
      </div>
    </div>
  </div>

  <!-- MENU ICON -->
  <div class="menu-bar">
    <div class="menu-icon" onclick="toggleMenu(true)">
      <svg viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg">
        <rect width="100" height="12" rx="6"></rect>
        <rect y="30" width="100" height="12" rx="6"></rect>
        <rect y="60" width="100" height="12" rx="6"></rect>
      </svg>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="side-menu" id="sideMenu">
    <div class="close-btn">
      <i class="fas fa-times" onclick="toggleMenu(false)"></i>
    </div>
    <h3>MENU</h3>
    <a href="#" onclick="loadSection('trangchuSV.html', 'info', event)" class="active">
      <i class="fas fa-home"></i> Trang Chủ
    </a>
    <a href="#" onclick="loadSection('thongtincanhan.html', 'info', event)">
      <i class="fas fa-user"></i> Thông tin cá nhân
    </a>
    <a href="#" onclick="loadSection('dangkitotnghiep.html', 'info', event)">
      <i class="fas fa-edit"></i> Đăng Kí Tốt Nghiệp
    </a>
    <a href="#" onclick="loadSection('thumoi.html', 'info', event)">
      <i class="fas fa-envelope"></i> Thư Mời
    </a>
    <a href="taikhoan.html">
      <i class="fas fa-id-card"></i> Tài Khoản
    </a>
    <a href="#" class="logout-link" onclick="logout()">
      <i class="fas fa-sign-out-alt"></i> Đăng xuất
    </a>
  </div>

  <div class="overlay" id="overlay" onclick="toggleMenu(false)"></div>

  <!-- CONTENT -->
  <div id="info" class="content-section"></div>


  <!-- SCRIPT -->
  <script>
    function toggleMenu(show) {
      const menu = document.getElementById("sideMenu");
      const overlay = document.getElementById("overlay");
      if (show) {
        menu.classList.add("menu-open");
        overlay.classList.add("active");
      } else {
        menu.classList.remove("menu-open");
        overlay.classList.remove("active");
      }
    }

    function loadSection(path, targetId, event) {
      // Lưu lại trang hiện tại
      localStorage.setItem("currentPage", path);

      fetch(path)
        .then((res) => res.text())
        .then((html) => {
          const target = document.getElementById(targetId);
          target.innerHTML = html;

          // Nếu đang ở trang thư mời
          if (path.includes("thumoi")) {
            const data = localStorage.getItem("studentInfo");
            if (data) {
              const student = JSON.parse(data);
              const span = document.getElementById("studentName");
              if (student?.fullname && span) {
                span.textContent = student.fullname;
              }
            }
          }

          // Highlight menu đang active
          document.querySelectorAll(".side-menu a").forEach(el => el.classList.remove("active"));
          if (event?.currentTarget) event.currentTarget.classList.add("active");
        })
        .catch((err) => {
          document.getElementById(targetId).innerHTML = "Không thể tải nội dung.";
          console.error("Lỗi:", err);
        });

      toggleMenu(false);
    }

    function logout() {
      localStorage.removeItem("studentInfo");
      localStorage.removeItem("currentPage");
      window.location.href = "dangnhap.html";
    }

    // Khi reload trang, tự động tải trang cũ
    window.addEventListener("DOMContentLoaded", () => {
      const savedPage = localStorage.getItem("currentPage");
      if (savedPage) {
        loadSection(savedPage, "info");
      } else {
        loadSection("trangchuSV.html", "info");
      }
    });

  </script>
</body>

</html>